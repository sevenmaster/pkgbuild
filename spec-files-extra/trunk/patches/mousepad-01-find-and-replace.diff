--- mousepad-0.2.16/src/search.c.orig	2011-06-08 17:25:56.659505600 -0400
+++ mousepad-0.2.16/src/search.c	2011-06-08 17:53:40.881688100 -0400
@@ -78,7 +78,9 @@
 static gint document_replace_real(StructData *sd)
 {
 	GtkTextIter iter, match_start, match_end;
-	GtkTextMark *mark_init = NULL;
+        GtkTextMark *mark_init = NULL, *mark_start, *mark_end;
+               mark_start = gtk_text_buffer_create_mark(textbuffer, NULL, &match_start, FALSE);
+               mark_end = gtk_text_buffer_create_mark(textbuffer, NULL, &match_end, FALSE);
 	gboolean res;
 	gint num = 0;
 	GtkWidget *q_dialog = NULL;
@@ -122,6 +124,11 @@
 				case GTK_RESPONSE_NO:
 					continue;
 				}
+
+			               gtk_text_buffer_get_iter_at_mark(textbuffer, &match_start, mark_start);
+               				gtk_text_buffer_get_iter_at_mark(textbuffer, &match_end, mark_end);
+              				 gtk_text_buffer_move_mark_by_name(textbuffer, "selection_bound",  &match_start);
+               				gtk_text_buffer_move_mark_by_name(textbuffer, "insert", &match_end);
 			}
 			gtk_text_buffer_delete_selection(textbuffer, TRUE, TRUE);
 			undo_set_sequency(TRUE);
@@ -210,8 +217,11 @@
 		G_CALLBACK(toggle_sensitivity), NULL);
 	 g_signal_connect(G_OBJECT(entry_find), "delete-text",
 		G_CALLBACK(toggle_sensitivity), NULL);
-	 if (sd->search.string_find) 
-		 gtk_entry_set_text(GTK_ENTRY(entry_find), sd->search.string_find);
+         if (sd->search.string_find) {
+              gtk_entry_set_text(GTK_ENTRY(entry_find), sd->search.string_find);
+               gtk_dialog_set_response_sensitive(GTK_DIALOG(dialog),
+                 GTK_RESPONSE_OK, TRUE);
+          }
 
 	gtk_dialog_set_default_response(GTK_DIALOG(dialog), GTK_RESPONSE_OK);
 	gtk_entry_set_activates_default(GTK_ENTRY(entry_find), TRUE);
@@ -275,8 +285,11 @@
 		G_CALLBACK(toggle_sensitivity), NULL);
 	 g_signal_connect(G_OBJECT(entry_find), "delete-text",
 		G_CALLBACK(toggle_sensitivity), NULL);
-	 if (sd->search.string_find) 
-		 gtk_entry_set_text(GTK_ENTRY(entry_find), sd->search.string_find);
+         if (sd->search.string_find) {
+            gtk_entry_set_text(GTK_ENTRY(entry_find), sd->search.string_find);
+             gtk_dialog_set_response_sensitive(GTK_DIALOG(dialog),
+               GTK_RESPONSE_OK, TRUE);
+         }
 	label_replace = gtk_label_new_with_mnemonic(_("Re_place with: "));
 	 gtk_misc_set_alignment(GTK_MISC(label_replace), 0, 0.5);
 	 gtk_table_attach_defaults(GTK_TABLE(table), label_replace, 0, 1, 1, 2);
