--- tmux-1.7/client.c	2012-10-11 09:51:06.000000000 -0700
+++ tmux-1.7-patched/client.c	2012-12-18 16:20:24.023595144 -0800
@@ -78,9 +78,12 @@
 	if ((lockfd = open(lockfile, O_WRONLY|O_CREAT, 0600)) == -1)
 		fatal("open failed");
 
-	if (flock(lockfd, LOCK_EX|LOCK_NB) == -1 && errno == EWOULDBLOCK) {
-		while (flock(lockfd, LOCK_EX) == -1 && errno == EINTR)
-			/* nothing */;
+	struct flock lock;
+	lock.l_type = F_WRLCK;
+	lock.l_whence = SEEK_SET;
+	lock.l_start = 0;
+	lock.l_len = 0;
+	if (fcntl(lockfd, F_SETLKW, &lock) == -1) {
 		close(lockfd);
 		return (-1);
 	}
